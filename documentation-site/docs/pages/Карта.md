# Карта (расчет)

## Координаты

Данный алгоритм переводит из декартовой системы координат (x, y), центр которой (0, 0) находится на южном полюсе, в географическую. Недостаток: из-за относительной простоты он хорошо работает только у южного полюса.

### Долгота

Географическая долгота — это расстояние от нулевого меридиана до нужной точки. На Луне он был установлен по соглашению и проходит через небольшой кратер Мёстинг А (Mösting A), расположенный вблизи экватора на видимой стороне. Для карты южного полюса - это “верх”.

Таким образом, долгота получается нахождением угла между “верхом” (нулевым меридианом) и прямой от центра до нужной точки, который в основном находится через арктангенс отношения x к y.

$$
∠ = arctan(x/y)
$$

После чего, из угла высчитываются градусы, минуты и секунды, зная что градусы = углу, 60 минут = 1 градусу, 60 секунд = 1 минуте.

$$
° = ∠; ‘ = 60 * °; “ = 60 * ‘
$$

Восточная долгота > 0, западная долгота < 0.

### Широта

Географическая широта — это расстояние от экватора до нужной точки.

Для этого находится расстояние (гипотенуза) от южного полюса (начала координат) до точки. После чего находится количество секунд в этом отрезке путем деления его на длину секунды. В итоге для нахождения координаты надо из координаты южного полюса (-90 градусов), переведенного в секунды (*3600), вычесть (в данном случае прибавить) найденное количество секунд, и из полученных найти минуты и градусы.

Северная широта > 0, южная широта < 0 (в данном примере может быть только южная).

Длина секунды для широты (отрезок по меридиану) = (длина окружности / 360) / 3600. 360 - количество градусов на окружности, 3600 - количество секунд в градусе. Полярный радиус Луны 1735,97 км. Секунда = 2*PI*R/360~= 8.416 метров.

$$
“ = -90 * 3600 + √(x² + y²) * 8.416
$$

$$
" = " \% 60; ‘ = (” / 60) \% 60; ° = ” / 3600
$$

% - взятие остатка.

## Расстояние между зонами

Поскольку рельеф на южном полюсе Луны не ровный, а с большими перепадами, расстояние между зонами нельзя посчитать как расстояние между координатами точек (через гипотенузу).

**Расчет**

В данном алгоритме расстояние рассчитывается как сумма расстояний между пикселей с учетом перепадов высот.

![Прямоугольный треугольник](https://cdn-user84060.skyeng.ru/uploads/617bdef303a40608750859-67b99a7804c1d310687701.webp)

Прямоугольный треугольник

Последнее расстояние рассчитывается как гипотенуза в прямоугольном треугольнике, в котором A и B - высоты двух пикселей, BC - перепад высот, а AC - расстояние между пикселями (они могут быть соседними: перемещение только по одной координате, или находиться по диагонали: перемещение по двум координатам одновременно)

**Направление**

Проход по пикселям происходит итерационно, при этом перемещение на пиксель происходит только тогда, когда “накопится” достаточно (≥ 1) *стремления*.

Итерационное *стремление* (добавляемое на каждой итерации) **dx** (**dy**) рассчитывается как отношение разности **deltaX** (**deltaY**) по определенной координате между текущей (или начальной) и конечной точки к сумме таких разностей по двум координатам.

$$
dx = deltaX / (deltaX + deltaY); dy = deltaY / (deltaX + deltaY)
$$

Данное *стремление* пересчитывается на каждой итерации с перемещением по пикселю (чтобы корректировать направление).

При выходе за карту высот перемещение происходит по тому же принципу, но считается что высота всех этих пикселей равна последней известной высоте.